{"version":3,"sources":["../../src/server/image-optimizer.ts"],"names":["mediaType","createHash","promises","getOrientation","Orientation","imageSizeOf","isAnimated","contentDisposition","join","nodeUrl","processBuffer","decodeBuffer","getMetadata","sendEtagResponse","getContentType","getExtension","chalk","createRequestResponseMocks","hasMatch","getImageBlurSvg","AVIF","WEBP","PNG","JPEG","GIF","SVG","ICO","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","e","showSharpMissingWarning","NODE_ENV","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","force","recursive","catch","rmdir","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","Math","max","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","optimizeImage","contentType","height","nextConfigOutput","optimizedBuffer","transformer","sequentialRead","rotate","resize","undefined","withoutEnlargement","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","mocked","method","socket","res","parse","hasStreamed","concat","buffers","getHeader","cacheControl","dangerouslyAllowSVG","vector","animate","output","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","imagesConfig","setHeader","finished","contentDispositionType","contentSecurityPolicy","sendResponse","result","byteLength","end","getImageSize","metadata","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}