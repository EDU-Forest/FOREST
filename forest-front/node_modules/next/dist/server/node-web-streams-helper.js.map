{"version":3,"sources":["../../src/server/node-web-streams-helper.ts"],"names":["encodeText","decodeText","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createDeferredSuffixStream","createInlineDataStream","createSuffixStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","input","TextEncoder","encode","textDecoder","decode","stream","streamToBufferedResult","renderResult","renderChunks","TextDecoder","writable","write","chunk","push","end","destroy","pipe","join","readable","transformStream","TransformStream","transformStream2","writer","getWriter","writer2","reader","getReader","read","then","done","value","close","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","bufferedString","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}