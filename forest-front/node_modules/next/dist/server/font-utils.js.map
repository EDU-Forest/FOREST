{"version":3,"sources":["../../src/server/font-utils.ts"],"names":["getFontDefinitionFromNetwork","getFontDefinitionFromManifest","calculateOverrideValues","calculateSizeAdjustValues","getFontOverrideCss","Log","capsizeFontsMetrics","require","https","CHROME_UA","IE_UA","isGoogleFont","url","startsWith","GOOGLE_FONT_PROVIDER","getFontForUA","UA","Promise","resolve","reject","rawData","get","headers","res","on","chunk","toString","e","result","warn","manifest","find","font","content","parseGoogleFontName","css","regex","matches","matchAll","fontNames","Set","fontFamily","replace","add","formatName","str","word","index","toLowerCase","toUpperCase","formatOverrideValue","val","Math","abs","toFixed","fontName","fontKey","fontMetrics","category","ascent","descent","lineGap","unitsPerEm","fallbackFont","DEFAULT_SERIF_FONT","DEFAULT_SANS_SERIF_FONT","name","xWidthAvg","mainFontAvgWidth","fallbackFontName","fallbackFontMetrics","fallbackFontAvgWidth","sizeAdjust","calculateOverrideCSS","trim","calculateSizeAdjustCSS","useSizeAdjust","calcFn","fontCss","reduce","cssStr","console","log"],"mappings":"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"}