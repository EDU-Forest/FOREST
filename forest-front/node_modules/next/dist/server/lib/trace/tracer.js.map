{"version":3,"sources":["../../../../src/server/lib/trace/tracer.ts"],"names":["api","require","err","context","trace","SpanStatusCode","SpanKind","isPromise","p","then","closeSpanWithError","span","error","recordException","setStatus","code","ERROR","message","end","rootSpanAttributesStore","Map","rootSpanIdKey","createContextKey","lastSpanId","getSpanId","NextTracerImpl","getTracerInstance","getTracer","getContext","getActiveScopeSpan","getSpan","active","args","type","fnOrOptions","fnOrEmpty","fn","options","NextVanillaSpanAllowlist","includes","process","env","NEXT_OTEL_VERBOSE","hideSpan","spanName","spanContext","getSpanContext","parentSpan","isRootSpan","ROOT_CONTEXT","spanId","attributes","with","setValue","startActiveSpan","onCleanup","delete","set","Object","entries","length","result","finally","wrap","tracer","name","optionsObj","apply","arguments","lastArgId","cb","scopeBoundCb","bind","_span","done","startSpan","setSpan","undefined","getRootSpanAttributes","getValue","get"],"mappings":"AAAA;;;;;AAAoD,IAAA,UAAa,WAAb,aAAa,CAAA;AAUjE,IAAIA,GAAG,AAAwD;AAE/D,gFAAgF;AAChF,8EAA8E;AAC9E,uCAAuC;AACvC,0EAA0E;AAC1E,+EAA+E;AAC/E,4CAA4C;AAC5C,6CAA6C;AAC7C,IAAI;IACFA,GAAG,GAAGC,OAAO,CAAC,oBAAoB,CAAC;CACpC,CAAC,OAAOC,GAAG,EAAE;IACZF,GAAG,GAAGC,OAAO,CAAC,uCAAuC,CAAC;CACvD;AAED,MAAM,EAAEE,OAAO,CAAA,EAAEC,KAAK,CAAA,EAAEC,cAAc,CAAA,EAAEC,QAAQ,CAAA,EAAE,GAAGN,GAAG;AAExD,MAAMO,SAAS,GAAG,CAAIC,CAAM,GAAsB;IAChD,OAAOA,CAAC,KAAK,IAAI,IAAI,OAAOA,CAAC,KAAK,QAAQ,IAAI,OAAOA,CAAC,CAACC,IAAI,KAAK,UAAU,CAAA;CAC3E;AAED,MAAMC,kBAAkB,GAAG,CAACC,IAAU,EAAEC,KAAa,GAAK;IACxD,IAAIA,KAAK,EAAE;QACTD,IAAI,CAACE,eAAe,CAACD,KAAK,CAAC;KAC5B;IACDD,IAAI,CAACG,SAAS,CAAC;QAAEC,IAAI,EAAEV,cAAc,CAACW,KAAK;QAAEC,OAAO,EAAEL,KAAK,QAAS,GAAdA,KAAAA,CAAc,GAAdA,KAAK,CAAEK,OAAO;KAAE,CAAC;IACvEN,IAAI,CAACO,GAAG,EAAE;CACX;AAkGD,gFAAgF,CAChF,MAAMC,uBAAuB,GAAG,IAAIC,GAAG,EAGpC;AACH,MAAMC,aAAa,GAAGrB,GAAG,CAACsB,gBAAgB,CAAC,iBAAiB,CAAC;AAC7D,IAAIC,UAAU,GAAG,CAAC;AAClB,MAAMC,SAAS,GAAG,IAAMD,UAAU,EAAE;AAEpC,MAAME,cAAc;IAClB;;;;KAIG,CACH,AAAQC,iBAAiB,GAAW;QAClC,OAAOtB,KAAK,CAACuB,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;KAC3C;IAED,AAAOC,UAAU,GAAe;QAC9B,OAAOzB,OAAO,CAAA;KACf;IAED,AAAO0B,kBAAkB,GAAqB;QAC5C,OAAOzB,KAAK,CAAC0B,OAAO,CAAC3B,OAAO,QAAQ,GAAfA,KAAAA,CAAe,GAAfA,OAAO,CAAE4B,MAAM,EAAE,CAAC,CAAA;KACxC;IAsBD,AAAO3B,KAAK,CAAI,GAAG4B,IAAI,AAAY,EAAE;QACnC,MAAM,CAACC,IAAI,EAAEC,WAAW,EAAEC,SAAS,CAAC,GAAGH,IAAI;QAE3C,+BAA+B;QAC/B,MAAM,EACJI,EAAE,CAAA,EACFC,OAAO,CAAA,IACR,GAIC,OAAOH,WAAW,KAAK,UAAU,GAC7B;YACEE,EAAE,EAAEF,WAAW;YACfG,OAAO,EAAE,EAAE;SACZ,GACD;YACED,EAAE,EAAED,SAAS;YACbE,OAAO,EAAE;gBAAE,GAAGH,WAAW;aAAE;SAC5B;QAEP,IACE,AAAC,CAACI,UAAwB,yBAAA,CAACC,QAAQ,CAACN,IAAI,CAAC,IACvCO,OAAO,CAACC,GAAG,CAACC,iBAAiB,KAAK,GAAG,IACvCL,OAAO,CAACM,QAAQ,EAChB;YACA,OAAOP,EAAE,EAAE,CAAA;SACZ;QAED,MAAMQ,QAAQ,GAAGP,OAAO,CAACO,QAAQ,IAAIX,IAAI;QAEzC,mHAAmH;QACnH,IAAIY,WAAW,GAAG,IAAI,CAACC,cAAc,CACnCT,CAAAA,OAAO,QAAY,GAAnBA,KAAAA,CAAmB,GAAnBA,OAAO,CAAEU,UAAU,CAAA,IAAI,IAAI,CAAClB,kBAAkB,EAAE,CACjD;QACD,IAAImB,UAAU,GAAG,KAAK;QAEtB,IAAI,CAACH,WAAW,EAAE;YAChBA,WAAW,GAAG7C,GAAG,CAACiD,YAAY;YAC9BD,UAAU,GAAG,IAAI;SAClB;QAED,MAAME,MAAM,GAAG1B,SAAS,EAAE;QAE1Ba,OAAO,CAACc,UAAU,GAAG;YACnB,gBAAgB,EAAEP,QAAQ;YAC1B,gBAAgB,EAAEX,IAAI;YACtB,GAAGI,OAAO,CAACc,UAAU;SACtB;QAED,OAAOnD,GAAG,CAACG,OAAO,CAACiD,IAAI,CAACP,WAAW,CAACQ,QAAQ,CAAChC,aAAa,EAAE6B,MAAM,CAAC,EAAE,IACnE,IAAI,CAACxB,iBAAiB,EAAE,CAAC4B,eAAe,CACtCV,QAAQ,EACRP,OAAO,EACP,CAAC1B,IAAU,GAAK;gBACd,MAAM4C,SAAS,GAAG,IAAM;oBACtBpC,uBAAuB,CAACqC,MAAM,CAACN,MAAM,CAAC;iBACvC;gBACD,IAAIF,UAAU,EAAE;oBACd7B,uBAAuB,CAACsC,GAAG,CACzBP,MAAM,EACN,IAAI9B,GAAG,CACLsC,MAAM,CAACC,OAAO,CAACtB,OAAO,CAACc,UAAU,IAAI,EAAE,CAAC,CAIzC,CACF;iBACF;gBACD,IAAI;oBACF,IAAIf,EAAE,CAACwB,MAAM,GAAG,CAAC,EAAE;wBACjB,OAAOxB,EAAE,CAACzB,IAAI,EAAE,CAACT,IAAW,GAAKQ,kBAAkB,CAACC,IAAI,EAAET,IAAG,CAAC,CAAC,CAAA;qBAChE;oBAED,MAAM2D,MAAM,GAAGzB,EAAE,CAACzB,IAAI,CAAC;oBAEvB,IAAIJ,SAAS,CAACsD,MAAM,CAAC,EAAE;wBACrBA,MAAM,CACHpD,IAAI,CACH,IAAME,IAAI,CAACO,GAAG,EAAE,EAChB,CAAChB,IAAG,GAAKQ,kBAAkB,CAACC,IAAI,EAAET,IAAG,CAAC,CACvC,CACA4D,OAAO,CAACP,SAAS,CAAC;qBACtB,MAAM;wBACL5C,IAAI,CAACO,GAAG,EAAE;wBACVqC,SAAS,EAAE;qBACZ;oBAED,OAAOM,MAAM,CAAA;iBACd,CAAC,OAAO3D,IAAG,EAAO;oBACjBQ,kBAAkB,CAACC,IAAI,EAAET,IAAG,CAAC;oBAC7BqD,SAAS,EAAE;oBACX,MAAMrD,IAAG,CAAA;iBACV;aACF,CACF,CACF,CAAA;KACF;IAaD,AAAO6D,IAAI,CAAC,GAAG/B,IAAI,AAAY,EAAE;QAC/B,MAAMgC,MAAM,GAAG,IAAI;QACnB,MAAM,CAACC,IAAI,EAAE5B,OAAO,EAAED,EAAE,CAAC,GACvBJ,IAAI,CAAC4B,MAAM,KAAK,CAAC,GAAG5B,IAAI,GAAG;YAACA,IAAI,CAAC,CAAC,CAAC;YAAE,EAAE;YAAEA,IAAI,CAAC,CAAC,CAAC;SAAC;QAEnD,IACE,CAACM,UAAwB,yBAAA,CAACC,QAAQ,CAAC0B,IAAI,CAAC,IACxCzB,OAAO,CAACC,GAAG,CAACC,iBAAiB,KAAK,GAAG,EACrC;YACA,OAAON,EAAE,CAAA;SACV;QAED,OAAO,WAAqB;YAC1B,IAAI8B,UAAU,GAAG7B,OAAO;YACxB,IAAI,OAAO6B,UAAU,KAAK,UAAU,IAAI,OAAO9B,EAAE,KAAK,UAAU,EAAE;gBAChE8B,UAAU,GAAGA,UAAU,CAACC,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC;aAC/C;YAED,MAAMC,SAAS,GAAGD,SAAS,CAACR,MAAM,GAAG,CAAC;YACtC,MAAMU,EAAE,GAAGF,SAAS,CAACC,SAAS,CAAC;YAE/B,IAAI,OAAOC,EAAE,KAAK,UAAU,EAAE;gBAC5B,MAAMC,YAAY,GAAGP,MAAM,CAACpC,UAAU,EAAE,CAAC4C,IAAI,CAACrE,OAAO,CAAC4B,MAAM,EAAE,EAAEuC,EAAE,CAAC;gBACnE,OAAON,MAAM,CAAC5D,KAAK,CAAC6D,IAAI,EAAEC,UAAU,EAAE,CAACO,KAAK,EAAEC,IAAI,GAAK;oBACrDN,SAAS,CAACC,SAAS,CAAC,GAAG,SAAUnE,IAAQ,EAAE;wBACzCwE,IAAI,QAAO,GAAXA,KAAAA,CAAW,GAAXA,IAAI,CAAGxE,IAAG,CAAC,CAAA;wBACX,OAAOqE,YAAY,CAACJ,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC,CAAA;qBAC3C;oBAED,OAAOhC,EAAE,CAAC+B,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC,CAAA;iBACjC,CAAC,CAAA;aACH,MAAM;gBACL,OAAOJ,MAAM,CAAC5D,KAAK,CAAC6D,IAAI,EAAEC,UAAU,EAAE,IAAM9B,EAAE,CAAC+B,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC,CAAC,CAAA;aACvE;SACF,CAAA;KACF;IAID,AAAOO,SAAS,CAAC,GAAG3C,IAAI,AAAY,EAAQ;QAC1C,MAAM,CAACC,IAAI,EAAEI,OAAO,CAAC,GAA4CL,IAAI,AAAO;QAE5E,MAAMa,WAAW,GAAG,IAAI,CAACC,cAAc,CACrCT,CAAAA,OAAO,QAAY,GAAnBA,KAAAA,CAAmB,GAAnBA,OAAO,CAAEU,UAAU,CAAA,IAAI,IAAI,CAAClB,kBAAkB,EAAE,CACjD;QACD,OAAO,IAAI,CAACH,iBAAiB,EAAE,CAACiD,SAAS,CAAC1C,IAAI,EAAEI,OAAO,EAAEQ,WAAW,CAAC,CAAA;KACtE;IAED,AAAQC,cAAc,CAACC,UAAiB,EAAE;QACxC,MAAMF,WAAW,GAAGE,UAAU,GAC1B3C,KAAK,CAACwE,OAAO,CAACzE,OAAO,CAAC4B,MAAM,EAAE,EAAEgB,UAAU,CAAC,GAC3C8B,SAAS;QAEb,OAAOhC,WAAW,CAAA;KACnB;IAED,AAAOiC,qBAAqB,GAAG;QAC7B,MAAM5B,MAAM,GAAG/C,OAAO,CAAC4B,MAAM,EAAE,CAACgD,QAAQ,CAAC1D,aAAa,CAAC,AAAU;QACjE,OAAOF,uBAAuB,CAAC6D,GAAG,CAAC9B,MAAM,CAAC,CAAA;KAC3C;CACF;AAED,MAAMvB,SAAS,GAAG,CAAC,IAAM;IACvB,MAAMqC,MAAM,GAAG,IAAIvC,cAAc,EAAE;IAEnC,OAAO,IAAMuC,MAAM,CAAA;CACpB,CAAC,EAAE;QAQF3D,cAAc,GAAdA,cAAc;QAEdC,QAAQ,GAARA,QAAQ;QANRqB,SAAS,GAATA,SAAS"}